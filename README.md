# AI 虚拟试衣间 (AI Virtual Try-On)

> 🎭 一款完全运行在浏览器中的 **纯前端 AI 虚拟试穿应用**。基于现代 **Gemini 架构**设计的单页面 PWA 应用，支持多种 AI 服务提供商，实现将任意服装图片"穿"在用户模特照片上。**零后端成本**、**绝对隐私保护**，所有敏感信息仅存储在用户本地。

![应用界面截图](./showPoto/show.png)
*(应用界面展示：左侧为模特照片，中间为服装选择，右侧为AI生成的试穿效果)*

---

## ✨ 核心特性

### 🎯 **核心价值**
- **🔒 绝对隐私保护**: API Key 和个人照片仅存储在浏览器本地，绝不上传服务器
- **⚡ 零后端架构**: 完全运行在浏览器中，可直接部署到静态托管平台
- **📱 PWA 应用体验**: 支持离线使用和应用安装，提供原生应用般的流畅体验
- **🎨 真实图像生成**: 基于专业 AI 模型生成逼真的虚拟试穿效果

### 🏗️ **技术亮点**
- **🧠 Gemini 架构**: 基于 SPA (单页面应用) 的现代化前端架构
- **🔄 智能路由**: 基于 Hash 的客户端路由系统，页面切换无需刷新
- **📦 模块化设计**: 服务层、提供商层、工具层清晰分离，易于维护和扩展
- **⚙️ 双 AI 提供商**: 支持 Google AI Studio (gemini-2.5-flash-image-preview) 和 Grsai (nano-banana-fast)，满足不同需求

### 🚀 **用户体验**
- **👆 直观操作**: 三步完成虚拟试穿，无需复杂配置
- **💾 本地存储**: 所有设置自动保存，下次使用无需重新配置
- **🎯 智能优化**: 图片自动压缩、API Key 轮询使用、错误自动重试
- **📲 移动优先**: 完美适配手机、平板和桌面设备

## 🎯 功能概览

### 📸 **虚拟试穿流程**
1. **服装上传**: 支持相册选择或拍摄，自动压缩和预处理
2. **模特管理**: 预设全身照作为基底，避免重复上传
3. **AI 生成**: 一键调用 AI 模型，实时生成试穿效果
4. **结果处理**: 支持保存到相册或分享给朋友

### ⚙️ **智能 API 管理**
- **双提供商支持**:
  - **Google AI Studio**: 基于 gemini-2.5-flash-image-preview 的多模态图像生成
  - **Grsai**: 专业图像生成，提供逼真效果
- **智能 Key 管理**:
  - Google AI 支持多 Key 轮询，最大化利用免费额度
  - 批量验证功能，实时显示 Key 状态
  - 完善的错误处理和状态跟踪机制
- **参数自定义**:
  - 温度调节控制生成创造性
  - 自定义提示词，支持 `[服装]` 占位符
  - 完全基于 REST API 的稳定调用方式

### 🎨 **现代化界面**
- **SPA 路由系统**: 流畅的页面切换，无需刷新
- **响应式设计**: 完美适配移动端和桌面端
- **实时反馈**: Toast 通知和加载指示器
- **PWA 体验**: 支持应用安装和离线使用

### 💾 **数据管理**
- **本地存储**: 所有设置自动保存，关闭浏览器后依然存在
- **智能同步**: 跨页面数据一致性保证
- **隐私保护**: 敏感信息仅存储在用户设备

## 🚀 快速开始

### 📋 **三步快速上手**

> 💡 **提示**: 本项目为纯前端应用，无需安装依赖或配置后端，直接在浏览器中运行即可！

#### **步骤 1️⃣: 启动应用**
```bash
# 克隆仓库
git clone https://github.com/your-username/ai-virtual-try-on.git
cd ai-virtual-try-on

# 启动本地服务器 (推荐方式)
# 方式一: 使用 Python
python -m http.server

# 方式二: 使用 Node.js
npx serve .

# 方式三: VS Code Live Server
# 安装 Live Server 扩展，右键 index.html 选择 "Open with Live Server"
```

然后在浏览器中访问 `http://localhost:8000` (或对应端口)

#### **步骤 2️⃣: 配置 API**
1. 点击右上角的 **设置按钮** (⚙️)
2. 选择 AI 提供商：
   - **Google AI Studio**: 从 [Google AI Studio](https://aistudio.google.com/app/apikey) 获取 API Key，使用 gemini-2.5-flash-image-preview 模型
   - **Grsai**: 联系服务方获取 API Key (推荐用于图像生成)
3. 添加 API Key (Google AI 支持添加多个，自动轮询使用)
4. 上传您的 **全身照** 作为模特基底
5. 调整 AI 参数 (可选)

#### **步骤 3️⃣: 开始试穿**
1. 返回主页面 (← 返回按钮)
2. **上传服装图片** - 从相册选择或拍摄
3. 点击 **"Generate Try-On"** 按钮
4. 等待 AI 生成结果
5. **保存或分享** 生成的图片

> 🎯 **使用建议**: 首次使用建议选择 Grsai 提供商，图像生成效果更佳！

### 🔧 **高级配置选项**
- **温度参数**: 0.0-1.0 之间，控制生成的创造性
- **自定义提示词**: 使用 `[服装]` 占位符，提供更精确的生成指导
- **API Key 轮询**: 添加多个 Google AI Key 可自动轮询使用

---

## 🛠️ 技术栈

### 🌐 **前端技术**
- **核心框架**: 原生 JavaScript (ES6 模块化)
- **样式系统**: Tailwind CSS (CDN 引入)
- **图标系统**: Google Material Icons
- **字体系统**: Space Grotesk (Google Fonts)

### 📱 **PWA 技术**
- **Service Worker**: 离线缓存、应用外壳模式
- **Web App Manifest**: 应用安装配置
- **缓存策略**: 缓存优先，后台更新

### 🤖 **AI 服务提供商**
- **Google AI Studio**: gemini-2.5-flash-image-preview 多模态图像生成模型 (nano banana)
- **Grsai**: nano-banana-fast 专业图像生成模型

---

## 🏗️ Gemini 架构详解

本项目采用现代化的 **Gemini 架构**，基于单页面应用 (SPA) 设计理念，实现了高度的模块化和可维护性。

### 🧠 **架构核心：路由系统**
```javascript
// assets/js/router.js - 应用架构核心
class Router {
  constructor() {
    this.routes = new Map([
      ['#home', () => import('./generator.js')],
      ['#settings', () => import('./settings.js')]
    ])
  }
}
```

**核心特性**:
- **Hash 路由**: 基于 URL hash 的客户端路由，无需服务器配置
- **模块按需加载**: 页面模块动态导入，优化初始加载性能
- **状态管理**: 统一的页面状态管理和导航控制

### 🏢 **分层架构设计**

#### **1. 概念层 (Conceptual Layer)**
```
┌─────────────────────────────────────┐
│           用户界面层                │
│    ┌─────────┐ ┌─────────┐ ┌───────┐ │
│    │ 主页面  │ │ 设置页  │ │测试页 │ │
│    └─────────┘ └─────────┘ └───────┘ │
└─────────────────────────────────────┘
```

#### **2. 服务层 (Service Layer)**
```
┌─────────────────────────────────────┐
│           服务抽象层                │
│  ┌─────────────────────────────────┐ │
│  │     api.service.js              │ │ ← API 调度中心
│  │  ┌─────────────┐ ┌─────────────┐│ │
│  │  │ Google AI   │ │   Grsai     ││ │ ← 提供商实现
│  │  │ Provider    │ │  Provider   ││ │
│  │  └─────────────┘ └─────────────┘│ │
│  └─────────────────────────────────┘ │
│  ┌─────────────────────────────────┐ │
│  │   storage.service.js            │ │ ← 数据持久化
│  └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

#### **3. 工具层 (Utility Layer)**
```
┌─────────────────────────────────────┐
│           工具函数层                │
│  ┌─────────────┐ ┌─────────────────┐ │
│  │ dom.util.js │ │ image.util.js   │ │
│  │ (DOM 操作)  │ │ (图片处理)      │ │
│  │             │ │ • 验证          │ │
│  │ • Toast     │ │ • 压缩          │ │
│  │ • 事件绑定  │ │ • 格式转换      │ │
│  └─────────────┘ └─────────────────┘ │
└─────────────────────────────────────┘
```

### 🔄 **数据流架构**

```
用户操作 → 页面控制器 → 服务层 → 提供商层 → AI 服务
    ↑           ↓           ↓          ↓         ↓
    ← 界面更新 ← 状态管理 ← 数据存储 ← 响应处理 ← API 响应
```

**关键设计决策**:
- **单一数据源**: `storage.service.js` 统一管理所有应用状态
- **提供商抽象**: 统一的 API 接口，支持无缝切换 AI 服务
- **错误边界**: 每层独立的错误处理和恢复机制
- **状态持久化**: 所有设置自动保存到 localStorage

---

## 📋 使用指南

### 🧭 **导航系统**
基于 SPA 架构的现代化导航体验：

- **主页面 → 设置页面**: 点击右上角设置图标 (⚙️)
- **设置页面 → 主页面**: 点击左上角返回图标 (←)

### 🎨 **界面特性**
- **响应式设计**: 完美适配手机、平板和桌面设备
- **Material Design 图标**: 清晰的视觉指引
- **实时反馈**: Toast 通知和加载状态指示器
- **流畅动画**: 页面切换和状态变化过渡效果

---

## 👨‍💻 开发者指南

### 📁 **项目结构**
```
AI-cosplay/
├── index.html              # 单页面应用入口 (SPA)
├── manifest.json           # PWA 应用配置
├── sw.js                   # Service Worker (离线支持)
├── README.md               # 项目文档
├── GEMINI.md               # 架构说明文档
└── assets/
    ├── icons/              # PWA 应用图标
    ├── css/                # 样式文件 (主要使用 Tailwind)
    └── js/
        ├── router.js          # 🧠 SPA路由核心
        ├── services/          # 服务层
        │   ├── storage.service.js    # 本地存储服务
        │   └── api.service.js        # API调度服务
        ├── providers/         # AI提供商实现层
        │   ├── google.provider.js    # Google AI提供商
        │   └── grsai.provider.js     # Grsai提供商
        ├── utils/             # 工具函数
        │   ├── dom.util.js           # DOM操作工具
        │   └── image.util.js         # 图片处理工具
        ├── generator.js       # 主页面功能模块
        └── settings.js        # 设置页面功能模块
```

### 🔧 **开发环境配置**

#### **本地开发服务器**
```bash
# 必须使用 HTTP 服务器，不支持 file:// 协议
# 方式一: Python
python -m http.server 8000

# 方式二: Node.js
npx serve -s . -p 8000

# 方式三: VS Code Live Server 扩展
# 右键 index.html → "Open with Live Server"
```

#### **关键开发注意事项**
1. **ES 模块**: 项目使用 ES6 模块化，需要现代浏览器支持
2. **CORS 策略**: 必须通过 HTTP 服务器访问，不支持直接打开文件
3. **PWA 缓存**: 开发时可能需要禁用 Service Worker 或清除缓存

### 🧩 **模块说明**

#### **核心模块**
- **`router.js`**: 应用架构核心，处理路由和模块加载
- **`storage.service.js`**: 统一的数据管理，处理 localStorage 操作
- **`api.service.js`**: AI 服务调度中心，根据设置选择提供商

#### **提供商模块**
- **`google.provider.js`**: Google AI Studio API 实现
- **`grsai.provider.js`**: Grsai API 实现，支持异步任务处理

#### **工具模块**
- **`dom.util.js`**: DOM 操作工具 (Toast、事件处理)
- **`image.util.js`**: 图片处理工具 (压缩、验证、格式转换)

### 🔌 **API 集成**

#### **添加新的 AI 提供商**
1. 在 `assets/js/providers/` 目录创建新的提供商文件
2. 实现统一的接口:
   ```javascript
   class NewProvider {
     async generateTryOn(clothingImage, modelImage, options) {
       // 实现具体的 API 调用逻辑
     }
   }
   ```
3. 在 `api.service.js` 中注册新提供商
4. 在设置页面添加相应的 UI 控件

#### **错误处理规范**
```javascript
try {
   // API 调用
} catch (error) {
   // 统一错误格式
   throw {
     provider: 'providerName',
     error: error.message,
     recoverable: false
   }
}
```

### 🚀 **部署指南**

#### **静态托管部署**
本项目可部署到任何静态托管平台：

```bash
# GitHub Pages
git subtree push --prefix dist origin gh-pages

# Vercel / Netlify
# 直接连接 Git 仓库，自动部署
```

#### **PWA 优化部署**
- 确保所有资源使用 HTTPS 协议
- 配置正确的 MIME 类型
- 更新 `manifest.json` 中的应用 URL
- Service Worker 缓存策略调整

---

## 🔒 隐私与安全

### 🛡️ **隐私保护机制**
- **本地存储**: 所有敏感数据 (API Keys、个人照片) 仅存储在用户设备的 localStorage 中
- **无服务器依赖**: 不会将任何用户数据上传到第三方服务器
- **直接 API 调用**: AI 请求直接从用户浏览器发送到 AI 服务提供商
- **数据清理**: 用户可随时通过浏览器设置清理所有本地数据

### 🔐 **安全注意事项**
- **API Key 管理**: 请妥善保管您的 API Keys，避免与他人分享
- **HTTPS 要求**: 生产环境必须使用 HTTPS 协议
- **浏览器兼容**: 建议使用现代浏览器 (Chrome 90+, Firefox 88+, Safari 14+)

---

## ⚠️ 重要提示

### 🤖 **AI 提供商对比**

#### **Google AI Studio (gemini-2.5-flash-image-preview)**
- **优势**:
  - 免费额度较大
  - 多模态理解能力强
  - 图像生成能力显著增强
  - 响应速度快
- **限制**:
  - 需要科学上网访问
  - 新模型可能存在稳定性问题
- **适用场景**: 服装分析、风格描述、内容理解、图像生成

#### **Grsai (nano-banana-fast)**
- **优势**:
  - 专业的图像生成模型
  - 虚拟试穿效果逼真
  - 针对试衣场景优化
- **限制**:
  - 需要联系服务方获取 API Key
  - 可能产生费用
- **适用场景**: 真实的虚拟试穿效果生成

### 🔧 **技术限制与解决方案**

#### **当前已知问题**
1. **Grsai 模特照片传递**:
   - 问题: 用户模特照片尚未完全传递给 Grsai API
   - 临时方案: 使用默认模特或等待后续更新

2. **图片显示适配**:
   - 问题: 固定宽高比可能导致显示不全
   - 解决方案: 调整 CSS 容器设置

3. **API 响应格式**:
   - 问题: 不同提供商返回格式不统一 ✅ **已解决**
   - 解决方案: 服务层统一处理转换

#### **已解决的技术问题**
- **Google API 调用稳定性**: 通过 REST API 实现和完善的错误处理机制，已解决 Google AI Studio 的调用问题
- **API Key 管理优化**: 实现了智能轮询和状态跟踪，最大化利用免费额度
- **模型兼容性**: 成功集成 gemini-2.5-flash-image-preview (nano banana) 模型

#### **使用建议**
- **网络环境**: 建议在稳定的网络环境下使用
- **图片质量**: 上传高清、光线充足的图片效果更佳
- **API 额度**: 关注 API 使用量，避免超限

---

## 🌟 项目状态

### ✅ **已完成功能**
- [x] **Gemini 架构重构**: 单页面应用 (SPA) 架构
- [x] **双 AI 提供商**: Google AI Studio + Grsai 支持
- [x] **智能路由系统**: 基于 Hash 的客户端路由
- [x] **模块化设计**: 服务层、提供商层、工具层分离
- [x] **PWA 支持**: 离线使用、应用安装
- [x] **API Key 管理**: 多 Key 轮询、状态跟踪
- [x] **响应式界面**: 移动端优化
- [x] **Nano Banana 集成**: gemini-2.5-flash-image-preview 模型集成
- [x] **API 问题解决**: Google AI 调用稳定性和错误处理优化

### 🚧 **开发中功能**
- [ ] **Grsai 图片传递**: 完善模特照片上传机制
- [ ] **图片适配优化**: 改进显示效果
- [ ] **错误处理增强**: 更友好的错误提示
- [ ] **深色模式**: 护眼主题支持

### 🎯 **未来规划**
- [ ] **批量处理**: 多件服装同时试穿
- [ ] **历史记录**: 生成结果管理
- [ ] **风格编辑**: 调整生成风格和参数
- [ ] **社区分享**: 优秀作品展示
- [ ] **多语言支持**: 国际化功能

---

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

### 📝 **开发规范**
1. **代码风格**: 遵循 ES6+ 标准
2. **模块化**: 保持功能模块独立
3. **错误处理**: 添加适当的错误捕获
4. **文档更新**: 重要变更需更新文档

### 🐛 **问题报告**
请使用 GitHub Issues 报告问题，包含：
- 详细的问题描述
- 复现步骤
- 浏览器和环境信息
- 错误截图 (如可能)

---

## 📄 许可证

本项目采用 [MIT](https://opensource.org/licenses/MIT) 许可证。

---

## 🙏 致谢

- **Google AI Studio**: 提供强大的多模态 AI 能力
- **Grsai**: 提供专业的图像生成服务
- **Tailwind CSS**: 优秀的实用优先 CSS 框架
- **Material Icons**: 精美的图标系统

---

<div align="center">

**⭐ 如果这个项目对您有帮助，请考虑给一个 Star！**

Made with ❤️ by AI Cosplay Team

</div>
